---
title: "NP explore"
author: "Gage Clawson"
date: "10/10/2022"
output: html_document
---

## Explore the NP data after new data updates

```{r setup, include=FALSE, message = F, warning = F}
knitr::opts_chunk$set(echo = TRUE, message = F, warning = F)

library(tidyverse)
library(here)
source('http://ohi-science.org/ohiprep_v2023/workflow/R/common.R')
```

```{r}
scores <- read_csv(file.path(here(), "yearly_results/global2023/OHI_final_formatted_scores_2023-09-15.csv"))


np_scores <- scores %>%
  filter(goal == "NP", dimension == "score", region_id != 0) 
  

## get top ten and bottom ten scores for 2021

DT::datatable(np_scores %>%
  filter(scenario == 2023) %>%
  arrange(-value) %>%
    dplyr::select(goal, dimension, region_name, scenario, value))


reds <-  colorRampPalette(c("#A50026", "#D73027", "#F46D43", "#FDAE61", "#FEE090"), space="Lab")(65)
blues <-  colorRampPalette(c("#E0F3F8", "#ABD9E9", "#74ADD1", "#4575B4", "#313695"))(35)
myPalette <-   c(reds, blues)
```


Let's highlight China and Indonesia, since we know their score is probably driven by seaweeds


```{r}
chn_np <- np_scores %>%
  filter(region_name %in% c("China", "Indonesia"))

# both scores have increased pretty dramatically over the past 10 years

fofm_scores <- read.csv('https://raw.githubusercontent.com/OHI-Science/ohiprep_v2023/gh-pages/globalprep/np/v2023/output/np_fofm_scores.csv')

overall_fofm <- fofm_scores %>%
  group_by(year) %>%
  summarise(avg_score = mean(score, na.rm = TRUE))

chn_fofm <- fofm_scores %>%
  filter(rgn_id == 209) ## ok so its not fofm... scores here are pretty good.

# what about seaweeds? Has there been a decrease in that? 

sw_sust <- read.csv('https://raw.githubusercontent.com/OHI-Science/ohiprep_v2023/gh-pages/globalprep/np/v2023/output/np_seaweed_sust.csv')

chn_sw_sust <- sw_sust %>%
  filter(rgn_id == 209) ## doesnt seem like there is a sw score here 

sw_prod <- read.csv('https://raw.githubusercontent.com/OHI-Science/ohiprep_v2023/gh-pages/globalprep/np/v2023/output/np_seaweed_harvest_tonnes.csv')

chn_sw_prod <- sw_prod %>%
  filter(rgn_id %in% c(209, 216)) %>% ## ok no sw production in China
  group_by(year) %>%
  summarise(total = sum(tonnes, na.rm = TRUE))

all_sw_prod <- sw_prod %>%
    group_by(year) %>%
  summarise(total = sum(tonnes, na.rm = TRUE))

chn_sw_prod/all_sw_prod

## China and Indonesia account for around 87% of all seaweed production in 2020.



prod_weights <- read.csv('https://raw.githubusercontent.com/OHI-Science/ohiprep_v2023/gh-pages/globalprep/np/v2023/output/np_product_weights.csv')

chn_idn_prod_weights <- prod_weights %>%
  filter(rgn_id %in% c(209, 216))

```

