---
title: "Global Ocean Health Index scores"
output:
  html_document:
    toc: true
    toc_float: true
---

Ocean Health Index scores are calculated for each region for each goal before being combined into an overall Index score. Methods have incrementally improved each year with new information and knowledge. Thus, for annual scores to be comparable through time, previous scores are recalculated with the most recent methods for each past assessment year. **All scores below use the 2020 methods**.

Below are eight years of global assessment scores for 220 regions (coastal nations and territories). <!---could bring back the Regions page to be only linked from here---> Flower plots illustrate the scores, with each petal representing an individual goal. Petal lengths convey the score of the goal, thus longer petals are closer to achieving their target. Only goals that are relevant to a region are scored, otherwise they are set to NA with grey petals. All scores are on a scale from 0-100, and the center number is the region's Index score.

----

```{r table all years, warning=FALSE, message=FALSE, echo=FALSE, results='asis'}
library(tidyverse)
source('_site.R')

## read in scores
data <- readr::read_csv('https://github.com/OHI-Science/ohi-global/raw/published/yearly_results/global2020/OHI_final_formatted_scores_2020-10-01.csv') 

## read in paths for figures
regions_figs <- readr::read_csv('https://raw.githubusercontent.com/OHI-Science/ohi-global/published/eez/conf/web/regions_figs.csv')

## list of regions, with flower pngs
regions <- data %>%
  dplyr::select(region_id) %>%
  dplyr::distinct() %>%
  dplyr::left_join(regions_figs, by = ('region_id'))

## arrange by region_name, with Global at the top
regions <- dplyr::bind_rows(
  regions %>%
    filter(region_id == 0),
  regions %>%
    filter(region_id !=0) %>%
    arrange(region_name))


## loop through and display each rgn_id
for (r in regions$region_id){ # r = regions$region_id[1]
  
  ## filter region_id and transpose
  r_scores <- data %>% 
    dplyr::filter(region_id == r,
           dimension == 'score') %>%
    dplyr::select(-region_id, -dimension) %>%
    tidyr::spread(scenario, value)
  
  r_scores_ordered <- data_frame(goal = c('Index', goals$goal)) %>%
    dplyr::left_join(r_scores, by='goal') %>%
    dplyr::select(-region_name, -goal) %>%
    dplyr::rename(goal = long_goal)
  
  
  ## display ----
  
  ## full flower filepath
  
  
  flower_path <- file.path(
    'https://raw.githubusercontent.com/OHI-Science/ohi-global/published',
    gsub("/home/sgclawson/github/ohi-global/", "", regions$flower_png[regions$region_id == r]))
  
  ## header, flower
  cat(sprintf('## %s\n\n![](%s)\n\n', 
              unique(r_scores$region_name), flower_path))
  
  ## table
  kable(r_scores_ordered) %>%
    print()
  cat('\n\n')
#  cat('----')
}

```

[<img src="https://docs.google.com/drawings/d/1633uvIYgsBhiKBddQAaTlvYDJgOK1uiDB6wkooNyhFc/pub?w=576&h=288" width="100px">](http://ohi-science.org)  
[ohi-science.org home](http://ohi-science.org)
